# -*- coding: utf-8 -*-
"""grocery2.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1G5Cperto5_SrZE70cjK-QIfeDCUH8w85
"""

import pandas as pd
#from prophet.plot import plot_plotly, plot_components_plotly
from prophet import Prophet
import numpy as np
import json

dataBH = pd.read_excel('Data.xlsx', header=None)

predicted_sums = []
groceries = dataBH.iloc[0, 1:]
grocery_list = groceries.tolist()
grocery_dict = {}

for i in range(1, 67):
    df = dataBH.iloc[2:,[0,i]]
    df.columns = ['ds', 'y']
    train = df.iloc[:len(df)]
    m = Prophet(n_changepoints=1)
    m.add_seasonality(name='monthly', period=30.5, fourier_order=5)
    m.fit(train)
    future = m.make_future_dataframe(periods=30) #MS for monthly, H for hourly
    forecast = m.predict(future)
    predictions = forecast.iloc[-30:]['yhat']
    # Extract the yhat column for the last 30 days of the forecast
    last_30_days = forecast.iloc[-30:]['yhat']

    # Calculate the sum of the predicted values for the last 30 days
    predicted_sum = last_30_days.sum()

    print("Sum of predicted values for the next 30 days for ",i,"is ", predicted_sum)
    predicted_sums.append(round(predicted_sum,2))
print(len(predicted_sums))
print(len(grocery_list))
print(predicted_sums)
print(grocery_list)
for i in range(len(grocery_list)):
    grocery_dict[grocery_list[i]] = predicted_sums[i]

print(grocery_dict)
json_data = json.dumps(grocery_dict)

# write JSON to a file
with open('grocery.json', 'w') as file:
    file.write(json_data)
